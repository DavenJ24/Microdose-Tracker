<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
  <meta name="theme-color" content="#0b0f18">
  <title>EchoSage • Microdose Tracker</title>
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="stylesheet" href="styles.css">
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script defer src="app.js"></script>
</head>
<body class="dark">
  <div class="bg">
    <div class="nebula"></div>
    <div class="stars"></div>
  </div>

  <header class="app-header glass">
    <div class="brand">
      <svg width="28" height="28" viewBox="0 0 100 100" aria-hidden="true"><path d="M50 12 C30 12 15 28 15 45 S27 80 50 88 85 60 85 45 70 12 50 12 Z" fill="none" stroke="#7ee787" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/></svg>
      <h1>EchoSage</h1>
    </div>
    <p class="tag">Microdose • Track • Reflect</p>
  </header>

  <main id="app">
    <section id="home" class="active">
      <h2>Home ✨</h2>
      <p class="intro">Your dashboard for today’s log, 7‑day trends, and gentle insights. Numbers are guides—not diagnoses.</p>

      <div id="kpis" class="kpi-grid"></div>

      <div class="insight glass" id="insightToday">
        <h3>Today’s Insight</h3>
        <div id="insightBody" class="muted">Log today to unlock a personalized read on what’s shifting.</div>
      </div>

      <div class="charts glass">
        <h3>Trends (tap legend to toggle)</h3>
        <canvas id="chartMood" height="200"></canvas>
        <canvas id="chartAnxiety" height="200"></canvas>
        <canvas id="chartStress" height="200"></canvas>
        <canvas id="chartSleep" height="200"></canvas>
        <canvas id="chartFtt" height="200"></canvas>
      </div>

      <div class="helper glass">
        <h3>How to read your trends</h3>
        <ul>
          <li><strong>Mood ↑</strong> + <strong>Anxiety ↓</strong> for 1–2 weeks can suggest a helpful trajectory—keep logging.</li>
          <li><strong>Sleep</strong> changes often lag—notice patterns across several days, not just one.</li>
          <li><strong>FTT speed</strong> (taps/10s) tends to vary day‑to‑day; look for gentle slopes, not spikes.</li>
        </ul>
        <p class="muted">This is self‑tracking, not medical advice. If distress escalates, seek professional help.</p>
      </div>
    </section>

    <section id="baseline">
      <h2>Baseline 🧭</h2>
      <p class="intro">Set your starting point. This helps your future self see changes clearly.</p>
      <form id="baselineForm" class="glass form">
        <div class="grid2">
          <label>Initials <input type="text" id="blInitials" maxlength="3" placeholder="ABC"></label>
          <label>Age <input type="number" id="blAge" min="12" max="120" placeholder="28"></label>
          <label>Height (cm) <input type="number" id="blHeight" min="100" max="250" placeholder="175"></label>
          <label>Weight (kg) <input type="number" id="blWeight" min="30" max="300" placeholder="72"></label>
        </div>
        <label>Hand dominance
          <select id="blHand"><option value="right">Right</option><option value="left">Left</option><option value="both">Both</option></select>
        </label>
        <label>Primary goals (hold to select multiple)
          <select id="blGoals" multiple>
            <option value="focus">Focus</option><option value="mood">Mood</option><option value="sleep">Sleep</option>
            <option value="anxiety">Anxiety</option><option value="pain">Pain</option>
          </select>
        </label>
        <label>Protocol
          <select id="blProtocol">
            <option value="fadiman">Fadiman (1 on / 2 off)</option>
            <option value="stamets">Stamets (4 on / 3 off)</option>
            <option value="custom">Custom</option>
          </select>
        </label>
        <div id="customPattern" class="hidden">
          <p>Select your custom 7‑day pattern (1 = dose, 0 = off):</p>
          <div class="day-pattern" id="patternInputs"></div>
        </div>

        <div class="stack scales">
          <fieldset class="scale"><legend>PHQ‑9 (Depression)</legend><div id="phq9-questions"></div></fieldset>
          <fieldset class="scale"><legend>GAD‑7 (Anxiety)</legend><div id="gad7-questions"></div></fieldset>
          <fieldset class="scale"><legend>PSS‑10 (Stress)</legend><div id="pss10-questions"></div></fieldset>
          <fieldset class="scale"><legend>WHO‑5 (Well‑being)</legend><div id="who5-questions"></div></fieldset>
        </div>

        <button type="button" id="saveBaseline" class="primary">Save Baseline</button>
      </form>

      <div id="baselineSummary" class="glass hidden"></div>
    </section>

    <section id="dosing">
      <h2>Dosing 🌿</h2>
      <p class="intro">Log each dosing event. This helps connect dose days with next‑day effects.</p>
      <form id="doseForm" class="glass form">
        <label>Date & time <input type="datetime-local" id="doseDate"></label>
        <div class="grid2">
          <label>Dose amount <input type="number" id="doseAmount" step="0.01" placeholder="0.10"></label>
          <label>Units
            <select id="doseUnit"><option value="g">g</option><option value="mg">mg</option></select>
          </label>
        </div>
        <label>Substance/form
          <select id="doseSubstance">
            <option value="psilocybin">Psilocybin microdose</option>
            <option value="lionsmane">Lion’s mane</option>
            <option value="niacin">Niacin</option>
            <option value="other">Other</option>
          </select>
        </label>
        <label>Strain/variety <input type="text" id="doseStrain" placeholder="(optional)"></label>
        <label>Route <select id="doseRoute"><option value="oral">Oral</option><option value="sublingual">Sublingual</option><option value="other">Other</option></select></label>
        <label>With food? <select id="doseFood"><option value="true">Yes</option><option value="false">No</option></select></label>
        <label>Set/setting <input type="text" id="doseContext" placeholder="e.g., quiet walk, journaling"></label>
        <label>Notes <textarea id="doseNotes" rows="2"></textarea></label>
        <label>Adverse event? <select id="doseAdverse"><option value="false">No</option><option value="true">Yes</option></select></label>
        <label id="doseAdverseNotesLabel" class="hidden">Adverse details <textarea id="doseAdverseNotes" rows="2"></textarea></label>
        <button type="button" id="saveDose" class="primary">Save Dose</button>
      </form>
      <div id="doseList" class="list glass"></div>
    </section>

    <section id="daily">
      <h2>Daily 🌙</h2>
      <p class="intro">Quick check‑in. Takes ~15 seconds. The magic is in doing it consistently.</p>
      <form id="dailyForm" class="glass form">
        <fieldset>
          <legend>Quick Log</legend>
          <div class="grid3">
            <label>Date <input type="date" id="dailyDate"></label>
            <label>Is dose day? <select id="dailyDoseDay"><option value="true">Yes</option><option value="false">No</option></select></label>
            <label>Sleep (h) <input type="number" id="dailySleep" step="0.1" min="0" max="24"></label>
          </div>
          <div class="grid4">
            <label>Sleep quality (1–5) <input type="number" id="dailySleepQuality" min="1" max="5"></label>
            <label>Rested (1–5) <input type="number" id="dailyRested" min="1" max="5"></label>
            <label>Mood (1–10) <input type="number" id="dailyMood" min="1" max="10"></label>
            <label>Anxiety (0–10) <input type="number" id="dailyAnxiety" min="0" max="10"></label>
          </div>
          <div class="grid3">
            <label>Focus (1–10) <input type="number" id="dailyFocus" min="1" max="10"></label>
            <label>Energy (1–10) <input type="number" id="dailyEnergy" min="1" max="10"></label>
            <label>Stress (0–10) <input type="number" id="dailyStress" min="0" max="10"></label>
          </div>
        </fieldset>
        <fieldset>
          <legend>Expanded (optional)</legend>
          <div class="grid3">
            <label>Productivity (1–10) <input type="number" id="dailyProductivity" min="1" max="10"></label>
            <label>Social (1–10) <input type="number" id="dailySocial" min="1" max="10"></label>
            <label>Libido (1–10) <input type="number" id="dailyLibido" min="1" max="10"></label>
          </div>
          <label>GI notes <textarea id="dailyGi" rows="2"></textarea></label>
          <label>Other notes <textarea id="dailyOther" rows="2"></textarea></label>
          <label>Adverse event? <select id="dailyAdverse"><option value="false">No</option><option value="true">Yes</option></select></label>
          <label id="dailyAdverseNotesLabel" class="hidden">Adverse details <textarea id="dailyAdverseNotes" rows="2"></textarea></label>
        </fieldset>
        <button type="button" id="saveDaily" class="primary">Save Today</button>
      </form>
      <div id="dailyList" class="list glass"></div>
    </section>

    <section id="weekly">
      <h2>Weekly 🧪</h2>
      <p class="intro">Full screens (PHQ‑9, GAD‑7, PSS‑10, WHO‑5). This summarizes your week in plain English.</p>
      <form id="weeklyForm" class="glass form">
        <label>Week start <input type="date" id="weeklyDate"></label>
        <fieldset class="scale"><legend>PHQ‑9</legend><div id="weekly-phq9"></div></fieldset>
        <fieldset class="scale"><legend>GAD‑7</legend><div id="weekly-gad7"></div></fieldset>
        <fieldset class="scale"><legend>PSS‑10</legend><div id="weekly-pss10"></div></fieldset>
        <fieldset class="scale"><legend>WHO‑5</legend><div id="weekly-who5"></div></fieldset>
        <label>Notes <textarea id="weeklyNotes" rows="2"></textarea></label>
        <button type="button" id="saveWeekly" class="primary">Save Weekly</button>
      </form>
      <div id="weeklyList" class="list glass"></div>
    </section>

    <section id="cognition">
      <h2>Cognition 🧠</h2>
      <div class="glass ftt">
        <h3>Finger Tapping Test</h3>
        <p class="muted"><strong>How:</strong> phone on a table; choose hand; tap the box <em>as fast as possible</em> for <strong>10s</strong>. Screen locks during test.</p>
        <label for="fttHand">Hand</label>
        <select id="fttHand"><option value="dominant">Dominant</option><option value="nondominant">Non‑dominant</option></select>
        <button type="button" id="fttStart" class="primary">Start Trial</button>
        <div id="fttTimer" class="timer">Ready</div>
        <div id="fttTapArea" class="tap-area" role="button" aria-label="tap area" tabindex="0">Tap here</div>
        <div id="fttResults" class="muted"></div>
      </div>
    </section>

    <section id="export">
      <h2>Export / Import ⬇️⬆️</h2>
      <div class="glass">
        <div class="btn-row">
          <button type="button" id="exportJson" class="secondary">Export JSON</button>
          <button type="button" id="exportCsv" class="secondary">Export CSVs</button>
          <button type="button" id="showData" class="secondary">Show Data</button>
        </div>
        <div id="exportOutput" class="code"></div>

        <h3>Import JSON</h3>
        <textarea id="importData" rows="4" placeholder="Paste exported JSON here"></textarea>
        <button type="button" id="importJson" class="primary">Import</button>
        <p class="muted small">Data stays on this device. Updating on the same domain won’t erase it. Clearing website data or changing domains will.</p>
      </div>
    </section>

    <section id="settings">
      <h2>Settings ⚙️</h2>
      <div class="glass form">
        <label>Protocol
          <select id="settingsProtocol">
            <option value="fadiman">Fadiman</option>
            <option value="stamets">Stamets</option>
            <option value="custom">Custom</option>
          </select>
        </label>
        <div id="settingsCustomPattern" class="hidden">
          <p>Custom 7‑day pattern:</p>
          <div id="settingsPattern"></div>
        </div>
        <label><input type="checkbox" id="settingsLargeText"> Large Text Mode</label>
        <label>Theme <select id="settingsTheme"><option value="dark">Dark</option><option value="light">Light</option></select></label>
        <button type="button" id="settingsClear" class="danger">Clear all data</button>
        <div class="muted small">
          <p><strong>Disclaimer:</strong> Self‑tracking tool, not medical advice. Laws vary by location. Avoid driving after dosing. Seek help for severe distress.</p>
        </div>
      </div>
    </section>
  </main>

  <nav id="bottomNav" class="glass">
    <button data-target="home">Home</button>
    <button data-target="baseline">Base</button>
    <button data-target="dosing">Dose</button>
    <button data-target="daily">Daily</button>
    <button data-target="weekly">Weekly</button>
    <button data-target="cognition">FTT</button>
    <button data-target="export">Export</button>
    <button data-target="settings">Settings</button>
  </nav>
</body>
</html>
